<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSVP Details</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/script.js"></script>
</head>
<body>
    <header>
        <img src="assets/images/logo.png" alt="Logo">
        <h1>RSVP Details</h1>
        <nav>
            <a href="admin-dashboard.html">Dashboard</a>
            <a href="logout">Logout</a>
        </nav>
    </header>
    <main>
        <h2>RSVP Details</h2>
        <div id="rsvp-details">
            <!-- RSVP details will be populated dynamically using JavaScript -->
        </div>
    </main>

    <script>
        // Fetch the list of RSVP details and populate the page
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Page loaded - Fetching RSVP details...");
            fetchRSVPDetails();
        });

        function fetchRSVPDetails() {
            fetch("admin?action=fetch_rsvp_details")
                .then(response => {
                    console.log("Response received:", response);
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("RSVP details data:", data);
                    const container = document.getElementById("rsvp-details");
                    container.innerHTML = ""; // Clear existing content

                    data.forEach(rsvp => {
                        const rsvpDiv = document.createElement("div");
                        rsvpDiv.innerHTML = `
                            <p><strong>User:</strong> ${rsvp.username}</p>
                            <p><strong>Event:</strong> ${rsvp.event_name}</p>
                            <button onclick="deleteRSVP(${rsvp.rsvp_id})">Delete</button>
                            <hr>
                        `;
                        container.appendChild(rsvpDiv);
                    });
                })
                .catch(error => {
                    console.error("Error fetching RSVP details:", error);
                    alert("Failed to fetch RSVP details. Please try again.");
                });
        }

        // Delete RSVP
        function deleteRSVP(rsvpId) {
            if (confirm("Are you sure you want to delete this RSVP?")) {
                fetch("admin?action=delete_rsvp&rsvp_id=" + rsvpId, { method: "POST" })
                    .then(response => {
                        if (response.ok) {
                            alert("RSVP deleted successfully!");
                            window.location.href = "rsvp-details.html";
                        } else {
                            alert("Failed to delete RSVP.");
                        }
                    })
                    .catch(error => {
                        console.error("Error deleting RSVP:", error);
                        alert("An error occurred while deleting the RSVP.");
                    });
            }
        }
    </script>
</body>
</html>