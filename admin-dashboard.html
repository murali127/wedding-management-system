<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/script.js"></script>
</head>
<body>
    <header>
        <img src="assets/images/logo.png" alt="Logo">
        <h1>Admin Dashboard</h1>
        <nav>
            <a href="admin-dashboard.html">Dashboard</a>
            <!--<a href="edit-event.html">Edit Events</a> !-->
            <a href="rsvp-details.html">RSVP Details</a>
            <a href="logout">Logout</a>
        </nav>
    </header>
    <main>
        <h2>Create Wedding</h2>
        <form id="createWeddingForm" action="admin" method="POST">
            <input type="hidden" name="action" value="create_wedding">
            <label for="name">Wedding Name:</label>
            <input type="text" id="name" name="name" required>
            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required>
            <label for="time">Time:</label>
            <input type="time" id="time" name="time" required>
            <label for="venue">Venue:</label>
            <input type="text" id="venue" name="venue" required>
            <button type="submit">Create Wedding</button>
        </form>

        <h2>Create Event</h2>
        <form id="createEventForm" action="admin" method="POST">
            <input type="hidden" name="action" value="create_event">
            <label for="wedding_id">Wedding:</label>
            <select id="wedding_id" name="wedding_id" required>
                <option value="">Select a Wedding</option>
                <!-- Options will be populated dynamically using JavaScript -->
            </select>
            <label for="event_name">Event Name:</label>
            <input type="text" id="event_name" name="name" required>
            <label for="event_date">Date:</label>
            <input type="date" id="event_date" name="date" required>
            <label for="event_time">Time:</label>
            <input type="time" id="event_time" name="time" required>
            <label for="event_venue">Venue:</label>
            <input type="text" id="event_venue" name="venue" required>
            <button type="submit">Create Event</button>
        </form>

        <h2>All Weddings and Events</h2>
        <div id="weddings-and-events">
            <!-- Weddings and events will be populated dynamically using JavaScript -->
        </div>
    </main>

    <script>
        // Fetch the list of weddings and events and populate the page
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Page loaded - Fetching weddings and events...");
            fetchWeddingsAndEvents();
            fetchWeddingsForDropdown(); // Fetch weddings for the dropdown
        });

        function fetchWeddingsAndEvents() {
            fetch("admin?action=fetch_weddings_and_events")
                .then(response => {
                    console.log("Response received:", response);
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Weddings and events data:", data);
                    const container = document.getElementById("weddings-and-events");
                    container.innerHTML = ""; // Clear existing content

                    data.weddings.forEach(wedding => {
                        const weddingDiv = document.createElement("div");
                        weddingDiv.innerHTML = `
                            <h3>Wedding: ${wedding.name}</h3>
                            <p>Date: ${wedding.date}, Time: ${wedding.time}, Venue: ${wedding.venue}</p>
                            <button onclick="editWedding(${wedding.id})">Edit Wedding</button>
                            <button onclick="deleteWedding(${wedding.id})">Delete Wedding</button>
                            <h4>Events:</h4>
                            <ul>
                                ${wedding.events.map(event => `
                                    <li>
                                        ${event.name} - Date: ${event.date}, Time: ${event.time}, Venue: ${event.venue}
                                        <button onclick="editEvent(${event.id})">Edit Event</button>
                                        <button onclick="deleteEvent(${event.id})">Delete Event</button>
                                    </li>
                                `).join("")}
                            </ul>
                        `;
                        container.appendChild(weddingDiv);
                    });
                })
                .catch(error => {
                    console.error("Error fetching weddings and events:", error);
                });
        }

        function fetchWeddingsForDropdown() {
            fetch("admin?action=fetch_weddings") // Add a new action to fetch weddings
                .then(response => {
                    console.log("Response received for weddings dropdown:", response);
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Weddings data for dropdown:", data);
                    const dropdown = document.getElementById("wedding_id");
                    dropdown.innerHTML = '<option value="">Select a Wedding</option>'; // Reset dropdown

                    data.weddings.forEach(wedding => {
                        const option = document.createElement("option");
                        option.value = wedding.id;
                        option.textContent = wedding.name;
                        dropdown.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error("Error fetching weddings for dropdown:", error);
                });
        }

        // Edit Wedding
        function editWedding(weddingId) {
            console.log("Edit Wedding - Wedding ID: " + weddingId);
            window.location.href = "edit-wedding.html?wedding_id=" + weddingId;
        }

        // Delete Wedding
        function deleteWedding(weddingId) {
            if (confirm("Are you sure you want to delete this wedding?")) {
                fetch("admin?action=delete_wedding&wedding_id=" + weddingId, { method: "POST" })
                    .then(response => {
                        if (response.ok) {
                            alert("Wedding deleted successfully!");
                            window.location.href = "admin-dashboard.html";
                        } else {
                            alert("Failed to delete wedding.");
                        }
                    })
                    .catch(error => {
                        console.error("Error deleting wedding:", error);
                        alert("An error occurred while deleting the wedding.");
                    });
            }
        }

        // Edit Event
        function editEvent(eventId) {
            console.log("Edit Event - Event ID: " + eventId);
            window.location.href = "edit-event.html?event_id=" + eventId;
        }

        // Delete Event
        function deleteEvent(eventId) {
    if (confirm("Are you sure you want to delete this event?")) {
        fetch("admin?action=delete_event&event_id=" + eventId, { method: "POST" })
            .then(response => {
                if (response.ok) {
                    alert("Event deleted successfully!");
                    window.location.href = "admin-dashboard.html";
                } else {
                    alert("Failed to delete event.");
                }
            })
            .catch(error => {
                console.error("Error deleting event:", error);
                alert("An error occurred while deleting the event.");
            });
    }
}
    </script>
</body>
</html>