<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weddings</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/script.js"></script>
</head>
<body>
    <header>
        <img src="assets/images/logo.png" alt="Logo">
        <h1>Weddings</h1>
        <nav>
            <a href="dashboard.html">Dashboard</a>
            <a href="logout">Logout</a>
        </nav>
    </header>
    <main>
        <h2>All Weddings</h2>
        <div id="wedding-list">
            <!-- Weddings will be populated dynamically using JavaScript -->
        </div>
    </main>

    <script>
        // Fetch the list of weddings and populate the page
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Page loaded - Fetching weddings...");
            fetchWeddings();
        });

        function fetchWeddings() {
    console.log("Fetching weddings...");
    fetch("wedding") // Ensure this matches the servlet URL mapping
        .then(response => {
            console.log("Response received:", response);
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            console.log("Weddings data:", data);
            const weddingList = document.getElementById("wedding-list");
            weddingList.innerHTML = ""; // Clear existing content
            data.forEach(wedding => {
                const weddingDiv = document.createElement("div");
                weddingDiv.innerHTML = `
                    <h3>${wedding.name}</h3>
                    <p>Date: ${wedding.date}, Time: ${wedding.time}, Venue: ${wedding.venue}</p>
                    <button onclick="rsvpWedding(${wedding.id})">RSVP to Wedding</button>
                    <button onclick="viewEvents(${wedding.id})">View Events</button>
                `;
                weddingList.appendChild(weddingDiv);
            });
        })
        .catch(error => {
            console.error("Error fetching weddings:", error);
            alert("Failed to fetch weddings. Please try again.");
        });
}
        function rsvpWedding(weddingId) {
            console.log("RSVP to Wedding - Wedding ID: " + weddingId);
            fetch("rsvp?action=rsvp_wedding&wedding_id=" + weddingId, { method: "POST" })
                .then(response => {
                    if (response.ok) {
                        alert("RSVP to Wedding successful!");
                        window.location.href = "dashboard.html";
                    } else {
                        alert("Failed to RSVP to Wedding.");
                    }
                })
                .catch(error => console.error("Error RSVPing to Wedding:", error));
        }

        function viewEvents(weddingId) {
    console.log("View Events - Wedding ID: " + weddingId);
    window.location.href = "events.html?wedding_id=" + weddingId; // Pass wedding_id as a query parameter
}
    </script>
</body>
</html>